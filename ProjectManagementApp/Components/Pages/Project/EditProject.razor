@page "/projects/edit/{Id}"
@rendermode InteractiveServer
@using Microsoft.AspNetCore.Authorization
@using Microsoft.EntityFrameworkCore
@using ProjectManagementApp.Components.Pages.Project.Shared
@using ProjectManagementApp.Data
@attribute [Authorize]
@inject ApplicationDbContext DbContext
@inject NavigationManager NavigationManager


<PageTitle>@Project?.Name - Edit</PageTitle>

<MudText Typo="Typo.h1" Class="px-6">@Project?.Name</MudText>

@if (Errors != null)
{
    <MudPaper Class="my-6 pa-8">
        <MudText Typo="Typo.caption" Class="px-6">@Errors</MudText>
    </MudPaper>
}

<MudPaper Class="pa-8">
    <ProjectDetailsForm Project="@Project" />

    <MudHidden Breakpoint="@Breakpoint.Sm">
        <MudPaper Class="my-6 pa-8">
            <MudText Typo="Typo.caption" Color="Color.Secondary" Class="px-6">these values are auto-filled upon project completion</MudText>
        </MudPaper>
        <MudText Typo="Typo.body1" Class="px-6">@Project?.ActualStart</MudText>
        <MudText Typo="Typo.body1" Class="px-6">@Project?.ActualEnd</MudText>
        <MudText Typo="Typo.body1" Class="px-6">@Project?.TotalWorkHours</MudText>
    </MudHidden>
</MudPaper>

<MudButton Variant="Variant.Filled" Color="Color.Primary" Class="my-4" @onclick="Save">Save</MudButton>


@code {
    [Parameter]
    public string? Id { get; set; }

    public Project? Project { get; set; }
    public string? Errors { get; set; } = null;

    protected override async Task OnInitializedAsync()
    {
        Project = await DbContext.Projects.FirstOrDefaultAsync(p => p.Id == Id);
    }

    public void Save() {
        try
        {
            DbContext.SaveChangesAsync();
            NavigationManager.NavigateTo("/projects/{id}");
        }
        catch (Exception ex)
        {
            Errors = ex.Message;
        }
    }
}